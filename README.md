# 云野迹(Yunyez) - 智能旅行打卡物联网系统

![项目架构图](docs/architecture.png)（后续补一张架构图，用DrawIO画，免费且简单）

## 🌟 项目简介
云野迹(Yunyez) 是一个 **定制电子宠物**，核心目标是打通“智能设备-后端服务-数据可视化”全链路：
- 设备端（ESP32开发板/模拟器）：通过 MQTT 上报定位、照片等打卡数据，支持自动/语音打卡；
- 后端服务：基于 Go 开发，用 gRPC 优化服务间通信，HTTP 提供前端接口，支持配置化规则扩展；
- 数据存储：PostgreSQL 存核心结构化数据，MongoDB 存非结构化附件，Redis 做缓存；
- 前端看板：可视化展示电子宠物的状态、旅行陪伴打卡记录、设备配置，支持实时推送。

## 🛠️ 技术栈
### 核心技术
| 分类         | 技术选型                                                                 |
|--------------|--------------------------------------------------------------------------|
| 后端语言     | Go 1.24.8                                                                 |
| 通信协议     | gRPC（服务间）、HTTP/JSON（前后端）、MQTT 3.1.1（设备-后端）、WebSocket（实时推送） |
| 数据序列化   | Protocol Buffers（Proto3）、JSON                                          |
| 数据库       | PostgreSQL 16（结构化核心数据）、MongoDB 6（非结构化数据）、Redis 7（缓存） |
| 中间件       | EMQX（MQTT Broker）、Docker（容器化）、K8s（集群部署）、Minikube（本地测试） |
| Web框架      | Gin（HTTP接口）                                                          |
| ORM/客户端   | GORM（PostgreSQL）、mongo-driver（MongoDB）、go-redis（Redis）、paho.mqtt.golang（MQTT） |

### 工程工具
- 版本控制：Git
- 文档：DrawIO + feishu
- 调试工具：Postman（HTTP）、MQTTX（MQTT）、Goland Debug
- 部署工具：Docker Compose（本地一键启动）、K8s（集群部署）

## 🎯 核心功能
### 1. 设备打卡模块
- ✅ 设备通过 MQTT 上报打卡数据（定位、照片、设备ID），支持 Proto/JSON 双格式
- ✅ 配置化打卡规则（景点范围、设备权限），无需改代码新增景点/设备
- ✅ 打卡有效性校验（定位与景点距离≤100米）
- ✅ 批量打卡支持（gRPC 流式通信，适配设备批量上报）

### 2. 后端服务模块
- ✅ 服务拆分：设备服务（MQTT消息处理、设备管理）、打卡服务（打卡逻辑、统计）
- ✅ 双通信模式：gRPC（服务间高效通信）+ HTTP（前端/第三方调用）
- ✅ 实时推送：WebSocket 推送打卡通知、设备在线状态
- ✅ 数据分层：Repository 层封装数据库操作，Service 层处理业务逻辑

### 3. 数据存储模块
- ✅ 结构化数据（用户、景点、打卡核心信息）→ PostgreSQL（支持事务、关联查询）
- ✅ 非结构化数据（打卡照片、设备日志）→ MongoDB（高写入、灵活扩展）
- ✅ 热点数据（设备在线状态、打卡缓存）→ Redis（高性能读取）

### 4. 可视化看板模块
- ✅ 旅行足迹地图：展示用户打卡地点分布
- ✅ 数据统计：按时间/景点/用户维度统计打卡次数
- ✅ 设备状态监控：查看设备在线状态、最近打卡记录
- ✅ 实时通知：打卡成功后前端实时收到提醒

### 5. 部署与运维
- ✅ Docker 容器化：所有服务+中间件支持 Docker 打包
- ✅ K8s 集群部署：支持服务扩容、配置管理、服务发现
- ✅ 日志记录：Zap 日志框架，按服务分类输出，便于问题排查

## 🏗️ 项目架构
### 整体架构图


### 核心数据流